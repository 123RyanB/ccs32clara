# ccs32clara User Manual

This manual is about the CCS charge controller, based on hardware "foccci" and software "ccs32clara".

https://github.com/uhi22/foccci

https://github.com/uhi22/ccs32clara

https://github.com/jsphuebner/ccs32clara

## RGB Blink Patterns

- White (R+G+B) solid: modem sleep or modem search. If there is no homeplug coordinator (charger or other homeplug network) detected, the homeplug modem enters a power-saving standby quite fast, approx 30 seconds after power-on or 30 seconds after the last seen homeplug traffic. As soon as a homeplug coordinator is detected, the modem wakes up automatically.
- Green solid: modem awake, waiting for plug
- Green slow blink: SLAC ongoing
- Green fast blinking: high-level protocol handshake
- Blue fast blinking: charge preparation
- Blue solid: charging
- Green/Blue fast blinking: charge finished
- Red: Error

## How to setup the build chain?

There are two totally different tool chains for Clara: The old one, until November 2023, uses the STM32 CubeIDE. The new one comes with a classical make file, and offers full flexibility regarding which editor/IDE is used. The description below is valid for the new variant.

On Windows:

- Install git
- open a git command shell.
- clone the repository from github: `$ git clone https://github.com/jsphuebner/ccs32clara`
- change into the cloned repository: `$ cd ccs32clara`
- get the submodules `$ git submodule init` and `$ git submodule update`
- Mingw64 has mingw32-make.exe instead of make.exe in its bin folder. So instead of `make` type `$ mingw32-make`. If this does not success, follow up with the next points.
- Try whether the compiler is found: `$ arm-none-eabi-gcc`
  If not, and you have already the ST CubeIDE installed, add the path to the compiler to your path variable, e.g.
C:\ST\STM32CubeIDE_1.12.1\STM32CubeIDE\plugins\com.st.stm32cube.ide.mcu.externaltools.gnu-tools-for-stm32.10.3-2021.10.win32_1.0.200.202301161003\tools\bin Or, if the arm tool chain is not yet installed, then install it (todo: how?)
- Now the make should work: `$ mingw32-make`
- This leads to error due to missing header file nvic.h. If there is no nvic.h then libopencm3 needs to be compiled. nvic.h is generated by a python script. To install and compile libopencm3, `$ mingw32-make get-deps`
- Now the make should work: `$ mingw32-make`
- This should create a file stm32_ccs.hex.
- The Clara project is designed to live together with a bootloader, and this bootloader needs to be copied from here: https://github.com/jsphuebner/stm32-CANBootloader/releases/download/v1.0/stm32_canloader.hex
- To flash this on the foccci board using STLink, use `$ ST-LINK_CLI -P stm32_canloader.hex -P stm32_ccs.hex -V`
- After successful flashing, make a power-off-on cycle to start the application.
